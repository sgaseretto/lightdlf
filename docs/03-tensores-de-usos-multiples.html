---

title: Añadiendo la posibilidad de usar multiples veces el mismo tensor
keywords: fastai
sidebar: home_sidebar

summary: "Como pasar varios gradientes a un tensor utilizado en multiples operaciones"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: notebooks/03-tensores-de-usos-multiples.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Como se vio al final del <a href="02-intro-autograd.ipynb">notebook</a> anterior, si un tensor participa en la creacion de más de un tensor, su gradiente no se acumula, simplemente sobreescribe el gradiente con el ultimo gradiente recibido por el tensor.</p>
<p>Para que un tensor pueda participar en la creacion de más de un tensor y mantener correctamente su gradiente es necesario añadir una nueva funcion y actualizar otras tres.</p>
<p>Primero que nada los gradientes tienen que poder ser acumulables, permitiendo que si un tensor es usado más de una vez, pueda recibir el gradiente de todos sus hijos (tensores que se originan a partir de el).
Adicionalmente se debe crear un contador que permite saber el número de gradientes recibidos por cada uno de los <code>hijos</code> o tensores creados a partir de los iniciales. Con este conteo también se previene retropropagar el gradiente del mismo hijo dos veces.</p>
<p>También el método <code>all_children_accounted_for()</code> se utiiza para computar si un tensor recibió el gradiente de todos sus hijos en el grafo</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">class</span> <span class="nc">Tensor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> 
                 <span class="n">autograd</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">creators</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">creation_op</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Inicializa un tensor utilizando numpy</span>
<span class="sd">        </span>
<span class="sd">        @data: una lista de numeros</span>
<span class="sd">        @creators: lista de tensores que participarion en la creacion de un nuevo tensor</span>
<span class="sd">        @creators_op: la operacion utilizada para combinar los tensores en el nuevo tensor</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creation_op</span> <span class="o">=</span> <span class="n">creation_op</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creators</span> <span class="o">=</span> <span class="n">creators</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grad</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autograd</span> <span class="o">=</span> <span class="n">autograd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># se asigna un id al tensor</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        
        <span class="c1"># se hace un seguimiento de cuantos hijos tiene un tensor</span>
        <span class="c1"># si los creadores no es none</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">creators</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="c1"># para cada tensor padre</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">creators</span><span class="p">:</span>
                <span class="c1"># se verifica si el tensor padre posee el id del tensor hijo</span>
                <span class="c1"># en caso de no estar, agrega el id del tensor hijo al tensor padre</span>
                <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">children</span><span class="p">):</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="c1"># si el tensor ya se encuentra entre los hijos del padre</span>
                <span class="c1"># y vuelve a aparece, se incrementa en uno</span>
                <span class="c1"># la cantidad de apariciones del tensor hijo</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    
    <span class="k">def</span> <span class="nf">all_children_grads_accounted_for</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tab</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">print_call</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Verifica si un tensor ha recibido la cantidad </span>
<span class="sd">        correcta de gradientes por cada uno de sus hijos</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># print(&#39;tensor id:&#39;, self.id)</span>
        <span class="c1"># print(tab+&#39;all_children_grads_accounted_for({})&#39;.format(self.id))</span>
        <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">print_call</span><span class="p">)</span> <span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">tab</span><span class="o">+</span><span class="s1">&#39;Tensor actual:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s1">&#39;hijo:&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">cnt</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">cnt</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>
        
    <span class="k">def</span> <span class="nf">backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="n">grad_origin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tab</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Funcion que propaga recursivamente el gradiente a los creators o padres del tensor</span>
<span class="sd">        </span>
<span class="sd">        @grad: gradiente </span>
<span class="sd">        @grad_orign</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># tab=tab</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">tab</span><span class="o">+</span><span class="s1">&#39;backward(</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="n">grad_origin</span><span class="p">))</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">autograd</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="n">grad_origin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">tab</span><span class="o">+</span><span class="s1">&#39;El gradiente de&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="s1">&#39;proviene de (grad_origin):&#39;</span><span class="p">,</span><span class="n">grad_origin</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s1">&#39;count:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">grad_origin</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>
                <span class="c1"># Verifica para asegurar si se puede hacer retropropagacion</span>
                <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">grad_origin</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No se puede retropropagar mas de una vez&quot;</span><span class="p">)</span>
                <span class="c1"># o si se está esperando un gradiente, en dicho caso se decrementa</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># el contador para ese hijo</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">grad_origin</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">tab</span><span class="o">+</span><span class="s1">&#39;por tanto el contador de&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="s1">&#39;se reduce a&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">grad_origin</span><span class="o">.</span><span class="n">id</span><span class="p">],</span> <span class="s1">&#39;para su hijo&#39;</span><span class="p">,</span> <span class="n">grad_origin</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        
        <span class="c1"># acumula el gradiente de multiples hijos</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grad</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grad</span> <span class="o">=</span> <span class="n">grad</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grad</span> <span class="o">+=</span> <span class="n">grad</span>
        
        
        <span class="nb">print</span><span class="p">(</span><span class="n">tab</span><span class="o">+</span><span class="s1">&#39;Tensor&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s1">&#39;has creators?&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">creators</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
              <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">tab</span><span class="o">+</span><span class="s1">&#39;All children grads from&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="s1">&#39;accounted for is (cnt != 0)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_children_grads_accounted_for</span><span class="p">(</span><span class="n">tab</span><span class="o">=</span><span class="n">tab</span><span class="p">,</span> <span class="n">print_call</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
              <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">tab</span><span class="o">+</span><span class="s1">&#39;Has grad origin?&#39;</span><span class="p">,</span> <span class="n">grad_origin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span>
              <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">tab</span><span class="o">+</span><span class="s1">&#39;Has creators and (children grads accounted or grad no grad origin)&#39;</span><span class="p">,</span>
              <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">tab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">creators</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;and&#39;</span><span class="p">,</span> <span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">all_children_grads_accounted_for</span><span class="p">(</span><span class="n">print_call</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">,</span><span class="s1">&#39;or&#39;</span><span class="p">,</span><span class="n">grad_origin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span><span class="s1">&#39;) =&gt;&#39;</span><span class="p">,</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">creators</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_children_grads_accounted_for</span><span class="p">(</span><span class="n">print_call</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="n">grad_origin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
             <span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">creators</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
          <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_children_grads_accounted_for</span><span class="p">(</span><span class="n">print_call</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="n">grad_origin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)):</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">creation_op</span> <span class="o">==</span> <span class="s1">&#39;add&#39;</span><span class="p">):</span>
                <span class="c1"># al recibir self.grad, empieza a realizar backprop</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">tab</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="s1">&#39;creators are:&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">tab</span><span class="o">+</span><span class="s1">&#39;creator&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">creators</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">creators</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                      <span class="s1">&#39;creator&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">creators</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">creators</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">tab</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">backward call from creator[0]:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">creators</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">creators</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grad</span><span class="p">,</span> <span class="n">grad_origin</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">tab</span><span class="o">=</span><span class="n">tab</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">tab</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">backward call from creator[1]&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">creators</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">creators</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grad</span><span class="p">,</span> <span class="n">grad_origin</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">tab</span><span class="o">=</span><span class="n">tab</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
                
        
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        @other: un Tensor</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">autograd</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">autograd</span><span class="p">):</span>
            <span class="n">new_tensor</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> 
                                <span class="n">autograd</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">creators</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">],</span>
                                <span class="n">creation_op</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  new tensor id is&#39;</span><span class="p">,</span> <span class="n">new_tensor</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">new_tensor</span>
        <span class="k">return</span> <span class="n">Tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">())</span>
    
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Visualizacion-de-las-llamadas-de-backward">Visualizacion de las llamadas de backward<a class="anchor-link" href="#Visualizacion-de-las-llamadas-de-backward">&#182;</a></h1><p>Se agrego al metodo backward una serie de <code>print()</code>s que permiten ver las llamadas a medida que se propaga el gradiente por cada uno de los tensores que participaron en la creación del tensor final, es decir la salida.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">autograd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;y = x + x&#39;</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;z = y + y&#39;</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">y</span>
<span class="nb">print</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x id:&#39;</span><span class="p">,</span><span class="n">x</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="k">for</span> <span class="n">hijo</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; hijo:&#39;</span><span class="p">,</span> <span class="n">hijo</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">cnt</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;y id:&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="k">for</span> <span class="n">hijo</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">y</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; hijo:&#39;</span><span class="p">,</span> <span class="n">hijo</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">cnt</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;z id:&#39;</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">z</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">x gradient data:&#39;</span><span class="p">,</span><span class="n">x</span><span class="o">.</span><span class="n">grad</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="c1"># z.backward(Tensor([1,1,1,1]))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>y = x + x
  new tensor id is 36485
z = y + y
  new tensor id is 39106

x id: 35424
 hijo: 36485 count 2
y id: 36485
 hijo: 39106 count 2
z id: 39106 

backward(39106, [1 1 1 1], None)
Tensor 39106 has creators? True 
All children grads from 39106 accounted for is (cnt != 0) True 
Has grad origin? True 
Has creators and (children grads accounted or grad no grad origin) 
 True and ( True or True ) =&gt; True
39106 creators are:
creator 36485 : [4 4 4 4] creator 36485 : [4 4 4 4]
	backward call from creator[0]: 36485
	backward(36485, [1 1 1 1], [8 8 8 8])
	El gradiente de 36485 proviene de (grad_origin): 39106 count: 2
	por tanto el contador de 36485 se reduce a 1 para su hijo 39106
	Tensor 36485 has creators? True 
	All children grads from 36485 accounted for is (cnt != 0) False 
	Has grad origin? False 
	Has creators and (children grads accounted or grad no grad origin) 
	 True and ( False or False ) =&gt; False

	backward call from creator[1] 36485
	backward(36485, [1 1 1 1], [8 8 8 8])
	El gradiente de 36485 proviene de (grad_origin): 39106 count: 1
	por tanto el contador de 36485 se reduce a 0 para su hijo 39106
	Tensor 36485 has creators? True 
	All children grads from 36485 accounted for is (cnt != 0) True 
	Has grad origin? False 
	Has creators and (children grads accounted or grad no grad origin) 
	 True and ( True or False ) =&gt; True
	36485 creators are:
	creator 35424 : [2 2 2 2] creator 35424 : [2 2 2 2]
		backward call from creator[0]: 35424
		backward(35424, [2 2 2 2], [4 4 4 4])
		El gradiente de 35424 proviene de (grad_origin): 36485 count: 2
		por tanto el contador de 35424 se reduce a 1 para su hijo 36485
		Tensor 35424 has creators? False 
		All children grads from 35424 accounted for is (cnt != 0) False 
		Has grad origin? False 
		Has creators and (children grads accounted or grad no grad origin) 
		 False and ( False or False ) =&gt; False

		backward call from creator[1] 35424
		backward(35424, [2 2 2 2], [4 4 4 4])
		El gradiente de 35424 proviene de (grad_origin): 36485 count: 1
		por tanto el contador de 35424 se reduce a 0 para su hijo 36485
		Tensor 35424 has creators? False 
		All children grads from 35424 accounted for is (cnt != 0) True 
		Has grad origin? False 
		Has creators and (children grads accounted or grad no grad origin) 
		 False and ( True or False ) =&gt; False

x gradient data: [4 4 4 4]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">autograd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">autograd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">autograd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;d = a + b&#39;</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;e = b + c&#39;</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;f = d + e&#39;</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">e</span>
<span class="nb">print</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a id:&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="k">for</span> <span class="n">hijo</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">hijo:&#39;</span><span class="p">,</span> <span class="n">hijo</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">cnt</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;b id:&#39;</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="k">for</span> <span class="n">hijo</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">hijo:&#39;</span><span class="p">,</span> <span class="n">hijo</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">cnt</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;c id:&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="k">for</span> <span class="n">hijo</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">hijo:&#39;</span><span class="p">,</span> <span class="n">hijo</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">cnt</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;d id:&#39;</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="k">for</span> <span class="n">hijo</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">hijo:&#39;</span><span class="p">,</span> <span class="n">hijo</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">cnt</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;e id:&#39;</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="k">for</span> <span class="n">hijo</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">hijo:&#39;</span><span class="p">,</span> <span class="n">hijo</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">cnt</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;f id:&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">f</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">grad</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>d = a + b
  new tensor id is 39565
e = b + c
  new tensor id is 30815
f = d + e
  new tensor id is 74828

a id: 65521
	hijo: 39565 count 1
b id: 59859
	hijo: 39565 count 1
	hijo: 30815 count 1
c id: 55699
	hijo: 30815 count 1
d id: 39565
	hijo: 74828 count 1
e id: 30815
	hijo: 74828 count 1
f id: 74828 

backward(74828, [1 1 1 1 1], None)
Tensor 74828 has creators? True 
All children grads from 74828 accounted for is (cnt != 0) True 
Has grad origin? True 
Has creators and (children grads accounted or grad no grad origin) 
 True and ( True or True ) =&gt; True
74828 creators are:
creator 39565 : [3 4 5 6 7] creator 30815 : [7 6 5 4 3]
	backward call from creator[0]: 39565
	backward(39565, [1 1 1 1 1], [10 10 10 10 10])
	El gradiente de 39565 proviene de (grad_origin): 74828 count: 1
	por tanto el contador de 39565 se reduce a 0 para su hijo 74828
	Tensor 39565 has creators? True 
	All children grads from 39565 accounted for is (cnt != 0) True 
	Has grad origin? False 
	Has creators and (children grads accounted or grad no grad origin) 
	 True and ( True or False ) =&gt; True
	39565 creators are:
	creator 65521 : [1 2 3 4 5] creator 59859 : [2 2 2 2 2]
		backward call from creator[0]: 65521
		backward(65521, [1 1 1 1 1], [3 4 5 6 7])
		El gradiente de 65521 proviene de (grad_origin): 39565 count: 1
		por tanto el contador de 65521 se reduce a 0 para su hijo 39565
		Tensor 65521 has creators? False 
		All children grads from 65521 accounted for is (cnt != 0) True 
		Has grad origin? False 
		Has creators and (children grads accounted or grad no grad origin) 
		 False and ( True or False ) =&gt; False

		backward call from creator[1] 65521
		backward(59859, [1 1 1 1 1], [3 4 5 6 7])
		El gradiente de 59859 proviene de (grad_origin): 39565 count: 1
		por tanto el contador de 59859 se reduce a 0 para su hijo 39565
		Tensor 59859 has creators? False 
		All children grads from 59859 accounted for is (cnt != 0) False 
		Has grad origin? False 
		Has creators and (children grads accounted or grad no grad origin) 
		 False and ( False or False ) =&gt; False

	backward call from creator[1] 39565
	backward(30815, [1 1 1 1 1], [10 10 10 10 10])
	El gradiente de 30815 proviene de (grad_origin): 74828 count: 1
	por tanto el contador de 30815 se reduce a 0 para su hijo 74828
	Tensor 30815 has creators? True 
	All children grads from 30815 accounted for is (cnt != 0) True 
	Has grad origin? False 
	Has creators and (children grads accounted or grad no grad origin) 
	 True and ( True or False ) =&gt; True
	30815 creators are:
	creator 59859 : [2 2 2 2 2] creator 55699 : [5 4 3 2 1]
		backward call from creator[0]: 59859
		backward(59859, [1 1 1 1 1], [7 6 5 4 3])
		El gradiente de 59859 proviene de (grad_origin): 30815 count: 1
		por tanto el contador de 59859 se reduce a 0 para su hijo 30815
		Tensor 59859 has creators? False 
		All children grads from 59859 accounted for is (cnt != 0) True 
		Has grad origin? False 
		Has creators and (children grads accounted or grad no grad origin) 
		 False and ( True or False ) =&gt; False

		backward call from creator[1] 59859
		backward(55699, [1 1 1 1 1], [7 6 5 4 3])
		El gradiente de 55699 proviene de (grad_origin): 30815 count: 1
		por tanto el contador de 55699 se reduce a 0 para su hijo 30815
		Tensor 55699 has creators? False 
		All children grads from 55699 accounted for is (cnt != 0) True 
		Has grad origin? False 
		Has creators and (children grads accounted or grad no grad origin) 
		 False and ( True or False ) =&gt; False
[ True  True  True  True  True]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x1</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">autograd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">autograd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x3 = x1 + x2&#39;</span><span class="p">)</span>
<span class="n">x3</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x4 = x1 + x2&#39;</span><span class="p">)</span>
<span class="n">x4</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x5 = x1+ x2 + x3 + x4&#39;</span><span class="p">)</span>
<span class="n">x5</span> <span class="o">=</span> <span class="n">x1</span><span class="o">+</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">x3</span> <span class="o">+</span> <span class="n">x4</span>
<span class="nb">print</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x1 id:&#39;</span><span class="p">,</span><span class="n">x1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="k">for</span> <span class="n">hijo</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">x1</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">hijo:&#39;</span><span class="p">,</span> <span class="n">hijo</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">cnt</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x2 id:&#39;</span><span class="p">,</span> <span class="n">x2</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="k">for</span> <span class="n">hijo</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">x2</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">hijo:&#39;</span><span class="p">,</span> <span class="n">hijo</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">cnt</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x3 id:&#39;</span><span class="p">,</span><span class="n">x3</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="k">for</span> <span class="n">hijo</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">x3</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">hijo:&#39;</span><span class="p">,</span> <span class="n">hijo</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">cnt</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x4 id:&#39;</span><span class="p">,</span> <span class="n">x4</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="k">for</span> <span class="n">hijo</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">x4</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">hijo:&#39;</span><span class="p">,</span> <span class="n">hijo</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">cnt</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x5 id:&#39;</span><span class="p">,</span> <span class="n">x5</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">x5</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>x3 = x1 + x2
  new tensor id is 7181
x4 = x1 + x2
  new tensor id is 56634
x5 = x1+ x2 + x3 + x4
  new tensor id is 28334
  new tensor id is 45990
  new tensor id is 92166

x1 id: 54166
	hijo: 7181 count 1
	hijo: 56634 count 1
	hijo: 28334 count 1
x2 id: 50546
	hijo: 7181 count 1
	hijo: 56634 count 1
	hijo: 28334 count 1
x3 id: 7181
	hijo: 45990 count 1
x4 id: 56634
	hijo: 92166 count 1
x5 id: 92166 

backward(92166, [1 1 1 1], None)
Tensor 92166 has creators? True 
All children grads from 92166 accounted for is (cnt != 0) True 
Has grad origin? True 
Has creators and (children grads accounted or grad no grad origin) 
 True and ( True or True ) =&gt; True
92166 creators are:
creator 45990 : [4 4 4 4] creator 56634 : [2 2 2 2]
	backward call from creator[0]: 45990
	backward(45990, [1 1 1 1], [6 6 6 6])
	El gradiente de 45990 proviene de (grad_origin): 92166 count: 1
	por tanto el contador de 45990 se reduce a 0 para su hijo 92166
	Tensor 45990 has creators? True 
	All children grads from 45990 accounted for is (cnt != 0) True 
	Has grad origin? False 
	Has creators and (children grads accounted or grad no grad origin) 
	 True and ( True or False ) =&gt; True
	45990 creators are:
	creator 28334 : [2 2 2 2] creator 7181 : [2 2 2 2]
		backward call from creator[0]: 28334
		backward(28334, [1 1 1 1], [4 4 4 4])
		El gradiente de 28334 proviene de (grad_origin): 45990 count: 1
		por tanto el contador de 28334 se reduce a 0 para su hijo 45990
		Tensor 28334 has creators? True 
		All children grads from 28334 accounted for is (cnt != 0) True 
		Has grad origin? False 
		Has creators and (children grads accounted or grad no grad origin) 
		 True and ( True or False ) =&gt; True
		28334 creators are:
		creator 54166 : [1 1 1 1] creator 50546 : [1 1 1 1]
			backward call from creator[0]: 54166
			backward(54166, [1 1 1 1], [2 2 2 2])
			El gradiente de 54166 proviene de (grad_origin): 28334 count: 1
			por tanto el contador de 54166 se reduce a 0 para su hijo 28334
			Tensor 54166 has creators? False 
			All children grads from 54166 accounted for is (cnt != 0) False 
			Has grad origin? False 
			Has creators and (children grads accounted or grad no grad origin) 
			 False and ( False or False ) =&gt; False

			backward call from creator[1] 54166
			backward(50546, [1 1 1 1], [2 2 2 2])
			El gradiente de 50546 proviene de (grad_origin): 28334 count: 1
			por tanto el contador de 50546 se reduce a 0 para su hijo 28334
			Tensor 50546 has creators? False 
			All children grads from 50546 accounted for is (cnt != 0) False 
			Has grad origin? False 
			Has creators and (children grads accounted or grad no grad origin) 
			 False and ( False or False ) =&gt; False

		backward call from creator[1] 28334
		backward(7181, [1 1 1 1], [4 4 4 4])
		El gradiente de 7181 proviene de (grad_origin): 45990 count: 1
		por tanto el contador de 7181 se reduce a 0 para su hijo 45990
		Tensor 7181 has creators? True 
		All children grads from 7181 accounted for is (cnt != 0) True 
		Has grad origin? False 
		Has creators and (children grads accounted or grad no grad origin) 
		 True and ( True or False ) =&gt; True
		7181 creators are:
		creator 54166 : [1 1 1 1] creator 50546 : [1 1 1 1]
			backward call from creator[0]: 54166
			backward(54166, [1 1 1 1], [2 2 2 2])
			El gradiente de 54166 proviene de (grad_origin): 7181 count: 1
			por tanto el contador de 54166 se reduce a 0 para su hijo 7181
			Tensor 54166 has creators? False 
			All children grads from 54166 accounted for is (cnt != 0) False 
			Has grad origin? False 
			Has creators and (children grads accounted or grad no grad origin) 
			 False and ( False or False ) =&gt; False

			backward call from creator[1] 54166
			backward(50546, [1 1 1 1], [2 2 2 2])
			El gradiente de 50546 proviene de (grad_origin): 7181 count: 1
			por tanto el contador de 50546 se reduce a 0 para su hijo 7181
			Tensor 50546 has creators? False 
			All children grads from 50546 accounted for is (cnt != 0) False 
			Has grad origin? False 
			Has creators and (children grads accounted or grad no grad origin) 
			 False and ( False or False ) =&gt; False

	backward call from creator[1] 45990
	backward(56634, [1 1 1 1], [6 6 6 6])
	El gradiente de 56634 proviene de (grad_origin): 92166 count: 1
	por tanto el contador de 56634 se reduce a 0 para su hijo 92166
	Tensor 56634 has creators? True 
	All children grads from 56634 accounted for is (cnt != 0) True 
	Has grad origin? False 
	Has creators and (children grads accounted or grad no grad origin) 
	 True and ( True or False ) =&gt; True
	56634 creators are:
	creator 54166 : [1 1 1 1] creator 50546 : [1 1 1 1]
		backward call from creator[0]: 54166
		backward(54166, [1 1 1 1], [2 2 2 2])
		El gradiente de 54166 proviene de (grad_origin): 56634 count: 1
		por tanto el contador de 54166 se reduce a 0 para su hijo 56634
		Tensor 54166 has creators? False 
		All children grads from 54166 accounted for is (cnt != 0) True 
		Has grad origin? False 
		Has creators and (children grads accounted or grad no grad origin) 
		 False and ( True or False ) =&gt; False

		backward call from creator[1] 54166
		backward(50546, [1 1 1 1], [2 2 2 2])
		El gradiente de 50546 proviene de (grad_origin): 56634 count: 1
		por tanto el contador de 50546 se reduce a 0 para su hijo 56634
		Tensor 50546 has creators? False 
		All children grads from 50546 accounted for is (cnt != 0) True 
		Has grad origin? False 
		Has creators and (children grads accounted or grad no grad origin) 
		 False and ( True or False ) =&gt; False
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">autograd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;y = x + x + x + x&#39;</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;z = y + y&#39;</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">y</span>
<span class="nb">print</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x id:&#39;</span><span class="p">,</span><span class="n">x</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="k">for</span> <span class="n">hijo</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; hijo:&#39;</span><span class="p">,</span> <span class="n">hijo</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">cnt</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;y id:&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="k">for</span> <span class="n">hijo</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">y</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; hijo:&#39;</span><span class="p">,</span> <span class="n">hijo</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">cnt</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;z id:&#39;</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">z</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">x gradient data:&#39;</span><span class="p">,</span><span class="n">x</span><span class="o">.</span><span class="n">grad</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>y = x + x + x + x
  new tensor id is 88879
  new tensor id is 57091
  new tensor id is 62010
z = y + y
  new tensor id is 83512

x id: 81129
 hijo: 88879 count 2
 hijo: 57091 count 1
 hijo: 62010 count 1
y id: 62010
 hijo: 83512 count 2
z id: 83512 

backward(83512, [1 1 1 1], None)
Tensor 83512 has creators? True 
All children grads from 83512 accounted for is (cnt != 0) True 
Has grad origin? True 
Has creators and (children grads accounted or grad no grad origin) 
 True and ( True or True ) =&gt; True
83512 creators are:
creator 62010 : [8 8 8 8] creator 62010 : [8 8 8 8]
	backward call from creator[0]: 62010
	backward(62010, [1 1 1 1], [16 16 16 16])
	El gradiente de 62010 proviene de (grad_origin): 83512 count: 2
	por tanto el contador de 62010 se reduce a 1 para su hijo 83512
	Tensor 62010 has creators? True 
	All children grads from 62010 accounted for is (cnt != 0) False 
	Has grad origin? False 
	Has creators and (children grads accounted or grad no grad origin) 
	 True and ( False or False ) =&gt; False

	backward call from creator[1] 62010
	backward(62010, [1 1 1 1], [16 16 16 16])
	El gradiente de 62010 proviene de (grad_origin): 83512 count: 1
	por tanto el contador de 62010 se reduce a 0 para su hijo 83512
	Tensor 62010 has creators? True 
	All children grads from 62010 accounted for is (cnt != 0) True 
	Has grad origin? False 
	Has creators and (children grads accounted or grad no grad origin) 
	 True and ( True or False ) =&gt; True
	62010 creators are:
	creator 57091 : [6 6 6 6] creator 81129 : [2 2 2 2]
		backward call from creator[0]: 57091
		backward(57091, [2 2 2 2], [8 8 8 8])
		El gradiente de 57091 proviene de (grad_origin): 62010 count: 1
		por tanto el contador de 57091 se reduce a 0 para su hijo 62010
		Tensor 57091 has creators? True 
		All children grads from 57091 accounted for is (cnt != 0) True 
		Has grad origin? False 
		Has creators and (children grads accounted or grad no grad origin) 
		 True and ( True or False ) =&gt; True
		57091 creators are:
		creator 88879 : [4 4 4 4] creator 81129 : [2 2 2 2]
			backward call from creator[0]: 88879
			backward(88879, [2 2 2 2], [6 6 6 6])
			El gradiente de 88879 proviene de (grad_origin): 57091 count: 1
			por tanto el contador de 88879 se reduce a 0 para su hijo 57091
			Tensor 88879 has creators? True 
			All children grads from 88879 accounted for is (cnt != 0) True 
			Has grad origin? False 
			Has creators and (children grads accounted or grad no grad origin) 
			 True and ( True or False ) =&gt; True
			88879 creators are:
			creator 81129 : [2 2 2 2] creator 81129 : [2 2 2 2]
				backward call from creator[0]: 81129
				backward(81129, [2 2 2 2], [4 4 4 4])
				El gradiente de 81129 proviene de (grad_origin): 88879 count: 2
				por tanto el contador de 81129 se reduce a 1 para su hijo 88879
				Tensor 81129 has creators? False 
				All children grads from 81129 accounted for is (cnt != 0) False 
				Has grad origin? False 
				Has creators and (children grads accounted or grad no grad origin) 
				 False and ( False or False ) =&gt; False

				backward call from creator[1] 81129
				backward(81129, [2 2 2 2], [4 4 4 4])
				El gradiente de 81129 proviene de (grad_origin): 88879 count: 1
				por tanto el contador de 81129 se reduce a 0 para su hijo 88879
				Tensor 81129 has creators? False 
				All children grads from 81129 accounted for is (cnt != 0) False 
				Has grad origin? False 
				Has creators and (children grads accounted or grad no grad origin) 
				 False and ( False or False ) =&gt; False

			backward call from creator[1] 88879
			backward(81129, [2 2 2 2], [6 6 6 6])
			El gradiente de 81129 proviene de (grad_origin): 57091 count: 1
			por tanto el contador de 81129 se reduce a 0 para su hijo 57091
			Tensor 81129 has creators? False 
			All children grads from 81129 accounted for is (cnt != 0) False 
			Has grad origin? False 
			Has creators and (children grads accounted or grad no grad origin) 
			 False and ( False or False ) =&gt; False

		backward call from creator[1] 57091
		backward(81129, [2 2 2 2], [8 8 8 8])
		El gradiente de 81129 proviene de (grad_origin): 62010 count: 1
		por tanto el contador de 81129 se reduce a 0 para su hijo 62010
		Tensor 81129 has creators? False 
		All children grads from 81129 accounted for is (cnt != 0) True 
		Has grad origin? False 
		Has creators and (children grads accounted or grad no grad origin) 
		 False and ( True or False ) =&gt; False

x gradient data: [8 8 8 8]
</pre>
</div>
</div>

</div>
</div>

</div>
</div>
 

