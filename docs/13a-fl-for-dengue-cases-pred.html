---

title: Title
keywords: fastai
sidebar: home_sidebar

summary: "summary"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: notebooks/13a-fl-for-dengue-cases-pred.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># all_flag</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Predicci&#243;n-de-casos-de-Dengue-preservando-la-privacidad-de-los-datos">Predicci&#243;n de casos de Dengue preservando la privacidad de los datos<a class="anchor-link" href="#Predicci&#243;n-de-casos-de-Dengue-preservando-la-privacidad-de-los-datos">&#182;</a></h1><p>Demo en la construcción de un modelo para la predicción de casos de dengue con el objetivo de preservar la privacidad de los datos utilizados.</p>
<p>Esta implementación trata de reproducir el paper <a href="https://csce.ucmss.com/books/LFS/CSREA2017/HIM3277.pdf">Prediction of Dengue Cases in Paraguay Using Artificial Neural
Networks</a> simulando una situación donde el <code>dataset</code> está distribuido en diferentes entidades y por motivos de privacidad, los mismos no pueden ser compartidos entre entidades.</p>
<h2 id="Motivaci&#243;n">Motivaci&#243;n<a class="anchor-link" href="#Motivaci&#243;n">&#182;</a></h2><p>Las tecnicas de machine learning pueden ayudar a mejorar el diagnostico de enfermedades, como detección de tumores en imagenes de MRI, detectar con tiempo retinopatía diabética en imagenes de retina, detección de cancer en imagenes de melanoma, hasta <strong>detectar el brotes de enfermedades</strong> entre varias otras aplicaciónes más. Pero este tipo de datos son bastante sensibles ya que son datos de los pacientes, una filtración de este tipo de información sería muy grave.</p>
<p>Pero no solo filtraciones, por culpa de varios escandalos respecto al uso de los datos sensibles de usuarios de parte de grandes empresas como Equifax, Facebook y Google generaron gran desconfianza en los mismos sobre como estos manipulan datos de sus usuarios. Un caso reciente es el uso de datos de pacientes para el <code>Proyecto Nightingale</code> de Google, el cual se encuentra bajo examinación por parte del gobierno estadounidense:</p>
<ul>
<li><a href="https://www.cbsnews.com/news/googles-project-nightingale-faces-government-inquiry-over-patient-privacy/"><strong>Google's "Project Nightingale" faces government inquiry over patient privacy</strong></a></li>
</ul>
<p>Mediante técnicas de preservación de privacidad como <a href="https://ai.googleblog.com/2017/04/federated-learning-collaborative.html"><em>Federated Learning</em></a>, <a href="https://privacytools.seas.harvard.edu/files/privacytools/files/pedagogical-document-dp_new.pdf"><em>Differential Privacy</em></a>, <a href="https://www.wikiwand.com/en/Homomorphic_encryption"><em>Homomorphic Encryption</em></a> entre otros es posible crear modelos útiles preservando la privacidad de los datos de los usuarios</p>
<blockquote><p>Obs.: En el notebook de <a href="13-federated-learning.ipynb">federated learning</a> se dan más detalle sobre federated learning, homomorphic encryption y sus posibles aplicaciónes</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">module_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">))</span>
<span class="k">if</span> <span class="n">module_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module_path</span><span class="p">)</span>
    
<span class="n">sys</span><span class="o">.</span><span class="n">setrecursionlimit</span><span class="p">(</span><span class="mi">15000</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Los modelos de este notebook se desarrollaran utilizando el framework desarrollado en los <code>notebooks</code> anteriores.</p>
<p>Se importan las clases necesarias para definir una red neuronal del framework <code>lightdlf</code> además de definirse un método de evaluación del modelo</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">phe</span>

<span class="kn">from</span> <span class="nn">lightdlf_old.cpu.core</span> <span class="k">import</span> <span class="n">Tensor</span>
<span class="kn">from</span> <span class="nn">lightdlf_old.cpu.layers</span> <span class="k">import</span> <span class="n">Linear</span><span class="p">,</span> <span class="n">Relu</span><span class="p">,</span> <span class="n">Sigmoid</span><span class="p">,</span> <span class="n">Tanh</span><span class="p">,</span> <span class="n">MSELoss</span><span class="p">,</span> <span class="n">Sequential</span>
<span class="kn">from</span> <span class="nn">lightdlf_old.cpu.optimizers</span> <span class="k">import</span> <span class="n">SGD</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">rmse</span> <span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">se_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">)):</span>
        <span class="n">se</span> <span class="o">=</span> <span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">se_sum</span> <span class="o">+=</span> <span class="n">se</span>
    
    <span class="n">mse</span> <span class="o">=</span> <span class="n">se_sum</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rmse</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Se carga el dataset con datos epidemiológicos y climatológicos</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;datasets/dengue/asu_dengue_dataset.csv&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cantidad(-1)</th>
      <th>cantidad(-2)</th>
      <th>cantidad(-3)</th>
      <th>cantidad(-4)</th>
      <th>cantidad(-5)</th>
      <th>cantidad(-6)</th>
      <th>cantidad(-7)</th>
      <th>cantidad(-8)</th>
      <th>cantidad(-9)</th>
      <th>cantidad(-10)</th>
      <th>...</th>
      <th>temperatura_min_media(-2)</th>
      <th>temperatura_min_media(-3)</th>
      <th>temperatura_min_media(-4)</th>
      <th>temperatura_min_media(-5)</th>
      <th>temperatura_min_media(-6)</th>
      <th>temperatura_min_media(-7)</th>
      <th>temperatura_min_media(-8)</th>
      <th>temperatura_min_media(-9)</th>
      <th>temperatura_min_media(-10)</th>
      <th>temperatura_min_media(-11)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>47</td>
      <td>50</td>
      <td>19</td>
      <td>15</td>
      <td>12</td>
      <td>8</td>
      <td>11</td>
      <td>0</td>
      <td>3</td>
      <td>2</td>
      <td>...</td>
      <td>20.714</td>
      <td>24.286</td>
      <td>22.857</td>
      <td>24.143</td>
      <td>21.143</td>
      <td>20.714</td>
      <td>21.000</td>
      <td>20.571</td>
      <td>21.714</td>
      <td>18.714</td>
    </tr>
    <tr>
      <td>1</td>
      <td>29</td>
      <td>47</td>
      <td>50</td>
      <td>19</td>
      <td>15</td>
      <td>12</td>
      <td>8</td>
      <td>11</td>
      <td>0</td>
      <td>3</td>
      <td>...</td>
      <td>19.429</td>
      <td>20.714</td>
      <td>24.286</td>
      <td>22.857</td>
      <td>24.143</td>
      <td>21.143</td>
      <td>20.714</td>
      <td>21.000</td>
      <td>20.571</td>
      <td>21.714</td>
    </tr>
    <tr>
      <td>2</td>
      <td>27</td>
      <td>29</td>
      <td>47</td>
      <td>50</td>
      <td>19</td>
      <td>15</td>
      <td>12</td>
      <td>8</td>
      <td>11</td>
      <td>0</td>
      <td>...</td>
      <td>21.286</td>
      <td>19.429</td>
      <td>20.714</td>
      <td>24.286</td>
      <td>22.857</td>
      <td>24.143</td>
      <td>21.143</td>
      <td>20.714</td>
      <td>21.000</td>
      <td>20.571</td>
    </tr>
    <tr>
      <td>3</td>
      <td>30</td>
      <td>27</td>
      <td>29</td>
      <td>47</td>
      <td>50</td>
      <td>19</td>
      <td>15</td>
      <td>12</td>
      <td>8</td>
      <td>11</td>
      <td>...</td>
      <td>21.143</td>
      <td>21.286</td>
      <td>19.429</td>
      <td>20.714</td>
      <td>24.286</td>
      <td>22.857</td>
      <td>24.143</td>
      <td>21.143</td>
      <td>20.714</td>
      <td>21.000</td>
    </tr>
    <tr>
      <td>4</td>
      <td>60</td>
      <td>30</td>
      <td>27</td>
      <td>29</td>
      <td>47</td>
      <td>50</td>
      <td>19</td>
      <td>15</td>
      <td>12</td>
      <td>8</td>
      <td>...</td>
      <td>17.429</td>
      <td>21.143</td>
      <td>21.286</td>
      <td>19.429</td>
      <td>20.714</td>
      <td>24.286</td>
      <td>22.857</td>
      <td>24.143</td>
      <td>21.143</td>
      <td>20.714</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 111 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># for column in df.columns:</span>
<span class="c1">#     print(column)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Se toman las columnas mencionadas en el <code>paper</code> para la creación del modelo</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_reduced</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;cantidad&#39;</span><span class="p">,</span>
                <span class="s1">&#39;cantidad(-1)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;temperatura_max_media(-1)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;temperatura_max_media(-2)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;temperatura_max_media(-3)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;temperatura_max_media(-4)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;temperatura_max_media(-5)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;temperatura_max_media(-6)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;temperatura_max_media(-7)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;temperatura_max_media(-8)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;temperatura_max_media(-9)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;temperatura_max_media(-10)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;temperatura_max_media(-11)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;lluvia_mm(-1)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;lluvia_mm(-2)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;humedad_min_media_porc(-1)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;humedad_min_media_porc(-2)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;humedad_min_media_porc(-3)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;humedad_min_media_porc(-4)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;humedad_min_media_porc(-5)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;humedad_min_media_porc(-6)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;humedad_min_media_porc(-7)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;humedad_min_media_porc(-8)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;humedad_min_media_porc(-9)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;humedad_min_media_porc(-10)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;humedad_min_media_porc(-11)&#39;</span><span class="p">]]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_reduced</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>cantidad                         int64
cantidad(-1)                     int64
temperatura_max_media(-1)      float64
temperatura_max_media(-2)      float64
temperatura_max_media(-3)      float64
temperatura_max_media(-4)      float64
temperatura_max_media(-5)      float64
temperatura_max_media(-6)      float64
temperatura_max_media(-7)      float64
temperatura_max_media(-8)      float64
temperatura_max_media(-9)      float64
temperatura_max_media(-10)     float64
temperatura_max_media(-11)     float64
lluvia_mm(-1)                  float64
lluvia_mm(-2)                  float64
humedad_min_media_porc(-1)     float64
humedad_min_media_porc(-2)     float64
humedad_min_media_porc(-3)     float64
humedad_min_media_porc(-4)     float64
humedad_min_media_porc(-5)     float64
humedad_min_media_porc(-6)     float64
humedad_min_media_porc(-7)     float64
humedad_min_media_porc(-8)     float64
humedad_min_media_porc(-9)     float64
humedad_min_media_porc(-10)    float64
humedad_min_media_porc(-11)    float64
dtype: object</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_reduced</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cantidad</th>
      <th>cantidad(-1)</th>
      <th>temperatura_max_media(-1)</th>
      <th>temperatura_max_media(-2)</th>
      <th>temperatura_max_media(-3)</th>
      <th>temperatura_max_media(-4)</th>
      <th>temperatura_max_media(-5)</th>
      <th>temperatura_max_media(-6)</th>
      <th>temperatura_max_media(-7)</th>
      <th>temperatura_max_media(-8)</th>
      <th>...</th>
      <th>humedad_min_media_porc(-2)</th>
      <th>humedad_min_media_porc(-3)</th>
      <th>humedad_min_media_porc(-4)</th>
      <th>humedad_min_media_porc(-5)</th>
      <th>humedad_min_media_porc(-6)</th>
      <th>humedad_min_media_porc(-7)</th>
      <th>humedad_min_media_porc(-8)</th>
      <th>humedad_min_media_porc(-9)</th>
      <th>humedad_min_media_porc(-10)</th>
      <th>humedad_min_media_porc(-11)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>29</td>
      <td>47</td>
      <td>33.286</td>
      <td>31.857</td>
      <td>36.000</td>
      <td>31.857</td>
      <td>34.429</td>
      <td>31.143</td>
      <td>33.000</td>
      <td>33.857</td>
      <td>...</td>
      <td>36.000</td>
      <td>34.429</td>
      <td>48.429</td>
      <td>43.000</td>
      <td>46.857</td>
      <td>48.571</td>
      <td>40.429</td>
      <td>39.571</td>
      <td>38.857</td>
      <td>20.714</td>
    </tr>
    <tr>
      <td>1</td>
      <td>27</td>
      <td>29</td>
      <td>34.857</td>
      <td>33.286</td>
      <td>31.857</td>
      <td>36.000</td>
      <td>31.857</td>
      <td>34.429</td>
      <td>31.143</td>
      <td>33.000</td>
      <td>...</td>
      <td>31.857</td>
      <td>36.000</td>
      <td>34.429</td>
      <td>48.429</td>
      <td>43.000</td>
      <td>46.857</td>
      <td>48.571</td>
      <td>40.429</td>
      <td>39.571</td>
      <td>38.857</td>
    </tr>
    <tr>
      <td>2</td>
      <td>30</td>
      <td>27</td>
      <td>35.571</td>
      <td>34.857</td>
      <td>33.286</td>
      <td>31.857</td>
      <td>36.000</td>
      <td>31.857</td>
      <td>34.429</td>
      <td>31.143</td>
      <td>...</td>
      <td>34.143</td>
      <td>31.857</td>
      <td>36.000</td>
      <td>34.429</td>
      <td>48.429</td>
      <td>43.000</td>
      <td>46.857</td>
      <td>48.571</td>
      <td>40.429</td>
      <td>39.571</td>
    </tr>
    <tr>
      <td>3</td>
      <td>60</td>
      <td>30</td>
      <td>31.000</td>
      <td>35.571</td>
      <td>34.857</td>
      <td>33.286</td>
      <td>31.857</td>
      <td>36.000</td>
      <td>31.857</td>
      <td>34.429</td>
      <td>...</td>
      <td>33.286</td>
      <td>34.143</td>
      <td>31.857</td>
      <td>36.000</td>
      <td>34.429</td>
      <td>48.429</td>
      <td>43.000</td>
      <td>46.857</td>
      <td>48.571</td>
      <td>40.429</td>
    </tr>
    <tr>
      <td>4</td>
      <td>79</td>
      <td>60</td>
      <td>34.429</td>
      <td>31.000</td>
      <td>35.571</td>
      <td>34.857</td>
      <td>33.286</td>
      <td>31.857</td>
      <td>36.000</td>
      <td>31.857</td>
      <td>...</td>
      <td>32.429</td>
      <td>33.286</td>
      <td>34.143</td>
      <td>31.857</td>
      <td>36.000</td>
      <td>34.429</td>
      <td>48.429</td>
      <td>43.000</td>
      <td>46.857</td>
      <td>48.571</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 26 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_reduced</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cantidad</th>
      <th>cantidad(-1)</th>
      <th>temperatura_max_media(-1)</th>
      <th>temperatura_max_media(-2)</th>
      <th>temperatura_max_media(-3)</th>
      <th>temperatura_max_media(-4)</th>
      <th>temperatura_max_media(-5)</th>
      <th>temperatura_max_media(-6)</th>
      <th>temperatura_max_media(-7)</th>
      <th>temperatura_max_media(-8)</th>
      <th>...</th>
      <th>humedad_min_media_porc(-2)</th>
      <th>humedad_min_media_porc(-3)</th>
      <th>humedad_min_media_porc(-4)</th>
      <th>humedad_min_media_porc(-5)</th>
      <th>humedad_min_media_porc(-6)</th>
      <th>humedad_min_media_porc(-7)</th>
      <th>humedad_min_media_porc(-8)</th>
      <th>humedad_min_media_porc(-9)</th>
      <th>humedad_min_media_porc(-10)</th>
      <th>humedad_min_media_porc(-11)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>count</td>
      <td>328.000000</td>
      <td>328.000000</td>
      <td>328.000000</td>
      <td>328.000000</td>
      <td>328.000000</td>
      <td>328.000000</td>
      <td>328.000000</td>
      <td>328.000000</td>
      <td>328.000000</td>
      <td>328.000000</td>
      <td>...</td>
      <td>328.000000</td>
      <td>328.000000</td>
      <td>328.000000</td>
      <td>328.000000</td>
      <td>328.000000</td>
      <td>328.000000</td>
      <td>328.000000</td>
      <td>328.000000</td>
      <td>328.00000</td>
      <td>328.000000</td>
    </tr>
    <tr>
      <td>mean</td>
      <td>111.030488</td>
      <td>110.945122</td>
      <td>28.538134</td>
      <td>28.558604</td>
      <td>28.608692</td>
      <td>28.623064</td>
      <td>28.648326</td>
      <td>28.675765</td>
      <td>28.695366</td>
      <td>28.727595</td>
      <td>...</td>
      <td>42.243988</td>
      <td>42.214372</td>
      <td>42.209146</td>
      <td>42.182143</td>
      <td>42.117247</td>
      <td>42.088500</td>
      <td>42.038851</td>
      <td>42.026655</td>
      <td>41.99878</td>
      <td>41.912979</td>
    </tr>
    <tr>
      <td>std</td>
      <td>247.165693</td>
      <td>247.183010</td>
      <td>4.833589</td>
      <td>4.833383</td>
      <td>4.825080</td>
      <td>4.827720</td>
      <td>4.836375</td>
      <td>4.824871</td>
      <td>4.829351</td>
      <td>4.828414</td>
      <td>...</td>
      <td>11.584123</td>
      <td>11.591668</td>
      <td>11.588468</td>
      <td>11.576231</td>
      <td>11.489590</td>
      <td>11.461491</td>
      <td>11.433179</td>
      <td>11.433673</td>
      <td>11.43021</td>
      <td>11.484073</td>
    </tr>
    <tr>
      <td>min</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>16.143000</td>
      <td>16.143000</td>
      <td>16.143000</td>
      <td>16.143000</td>
      <td>16.143000</td>
      <td>16.143000</td>
      <td>16.143000</td>
      <td>16.143000</td>
      <td>...</td>
      <td>15.429000</td>
      <td>15.429000</td>
      <td>15.429000</td>
      <td>15.429000</td>
      <td>15.429000</td>
      <td>15.429000</td>
      <td>15.429000</td>
      <td>15.429000</td>
      <td>15.42900</td>
      <td>15.429000</td>
    </tr>
    <tr>
      <td>25%</td>
      <td>2.750000</td>
      <td>2.750000</td>
      <td>25.429000</td>
      <td>25.429000</td>
      <td>25.535500</td>
      <td>25.535500</td>
      <td>25.535500</td>
      <td>25.571000</td>
      <td>25.571000</td>
      <td>25.678250</td>
      <td>...</td>
      <td>34.107250</td>
      <td>34.107250</td>
      <td>34.107250</td>
      <td>34.107250</td>
      <td>34.107250</td>
      <td>34.107250</td>
      <td>34.107250</td>
      <td>34.107250</td>
      <td>34.10725</td>
      <td>34.000000</td>
    </tr>
    <tr>
      <td>50%</td>
      <td>18.500000</td>
      <td>18.500000</td>
      <td>29.357500</td>
      <td>29.429000</td>
      <td>29.500000</td>
      <td>29.571000</td>
      <td>29.571000</td>
      <td>29.571000</td>
      <td>29.571000</td>
      <td>29.571000</td>
      <td>...</td>
      <td>42.214500</td>
      <td>42.071500</td>
      <td>42.071500</td>
      <td>42.071500</td>
      <td>42.071500</td>
      <td>42.071500</td>
      <td>41.928500</td>
      <td>41.857000</td>
      <td>41.78550</td>
      <td>41.714000</td>
    </tr>
    <tr>
      <td>75%</td>
      <td>76.500000</td>
      <td>76.500000</td>
      <td>32.429000</td>
      <td>32.429000</td>
      <td>32.429000</td>
      <td>32.429000</td>
      <td>32.429000</td>
      <td>32.429000</td>
      <td>32.429000</td>
      <td>32.464500</td>
      <td>...</td>
      <td>48.857000</td>
      <td>48.857000</td>
      <td>48.749750</td>
      <td>48.606750</td>
      <td>48.464500</td>
      <td>48.464500</td>
      <td>48.321750</td>
      <td>48.321750</td>
      <td>48.32175</td>
      <td>48.286000</td>
    </tr>
    <tr>
      <td>max</td>
      <td>1691.000000</td>
      <td>1691.000000</td>
      <td>39.714000</td>
      <td>39.714000</td>
      <td>39.714000</td>
      <td>39.714000</td>
      <td>39.714000</td>
      <td>39.714000</td>
      <td>39.714000</td>
      <td>39.714000</td>
      <td>...</td>
      <td>78.857000</td>
      <td>78.857000</td>
      <td>78.857000</td>
      <td>78.857000</td>
      <td>78.857000</td>
      <td>78.857000</td>
      <td>78.857000</td>
      <td>78.857000</td>
      <td>78.85700</td>
      <td>78.857000</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 26 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">max_values</span> <span class="o">=</span> <span class="n">df_reduced</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">min_values</span> <span class="o">=</span> <span class="n">df_reduced</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

<span class="c1"># Normalización del dataset</span>
<span class="n">df_normalizado</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_reduced</span> <span class="o">-</span> <span class="n">df_reduced</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">df_reduced</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">df_reduced</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_normalizado</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cantidad</th>
      <th>cantidad(-1)</th>
      <th>temperatura_max_media(-1)</th>
      <th>temperatura_max_media(-2)</th>
      <th>temperatura_max_media(-3)</th>
      <th>temperatura_max_media(-4)</th>
      <th>temperatura_max_media(-5)</th>
      <th>temperatura_max_media(-6)</th>
      <th>temperatura_max_media(-7)</th>
      <th>temperatura_max_media(-8)</th>
      <th>...</th>
      <th>humedad_min_media_porc(-2)</th>
      <th>humedad_min_media_porc(-3)</th>
      <th>humedad_min_media_porc(-4)</th>
      <th>humedad_min_media_porc(-5)</th>
      <th>humedad_min_media_porc(-6)</th>
      <th>humedad_min_media_porc(-7)</th>
      <th>humedad_min_media_porc(-8)</th>
      <th>humedad_min_media_porc(-9)</th>
      <th>humedad_min_media_porc(-10)</th>
      <th>humedad_min_media_porc(-11)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.017150</td>
      <td>0.027794</td>
      <td>0.727292</td>
      <td>0.666667</td>
      <td>0.842433</td>
      <td>0.666667</td>
      <td>0.775784</td>
      <td>0.636375</td>
      <td>0.715158</td>
      <td>0.751517</td>
      <td>...</td>
      <td>0.324320</td>
      <td>0.299552</td>
      <td>0.520275</td>
      <td>0.434682</td>
      <td>0.495491</td>
      <td>0.522514</td>
      <td>0.394148</td>
      <td>0.380621</td>
      <td>0.369364</td>
      <td>0.083323</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.015967</td>
      <td>0.017150</td>
      <td>0.793942</td>
      <td>0.727292</td>
      <td>0.666667</td>
      <td>0.842433</td>
      <td>0.666667</td>
      <td>0.775784</td>
      <td>0.636375</td>
      <td>0.715158</td>
      <td>...</td>
      <td>0.259002</td>
      <td>0.324320</td>
      <td>0.299552</td>
      <td>0.520275</td>
      <td>0.434682</td>
      <td>0.495491</td>
      <td>0.522514</td>
      <td>0.394148</td>
      <td>0.380621</td>
      <td>0.369364</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.017741</td>
      <td>0.015967</td>
      <td>0.824233</td>
      <td>0.793942</td>
      <td>0.727292</td>
      <td>0.666667</td>
      <td>0.842433</td>
      <td>0.666667</td>
      <td>0.775784</td>
      <td>0.636375</td>
      <td>...</td>
      <td>0.295043</td>
      <td>0.259002</td>
      <td>0.324320</td>
      <td>0.299552</td>
      <td>0.520275</td>
      <td>0.434682</td>
      <td>0.495491</td>
      <td>0.522514</td>
      <td>0.394148</td>
      <td>0.380621</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.035482</td>
      <td>0.017741</td>
      <td>0.630308</td>
      <td>0.824233</td>
      <td>0.793942</td>
      <td>0.727292</td>
      <td>0.666667</td>
      <td>0.842433</td>
      <td>0.666667</td>
      <td>0.775784</td>
      <td>...</td>
      <td>0.281532</td>
      <td>0.295043</td>
      <td>0.259002</td>
      <td>0.324320</td>
      <td>0.299552</td>
      <td>0.520275</td>
      <td>0.434682</td>
      <td>0.495491</td>
      <td>0.522514</td>
      <td>0.394148</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.046718</td>
      <td>0.035482</td>
      <td>0.775784</td>
      <td>0.630308</td>
      <td>0.824233</td>
      <td>0.793942</td>
      <td>0.727292</td>
      <td>0.666667</td>
      <td>0.842433</td>
      <td>0.666667</td>
      <td>...</td>
      <td>0.268020</td>
      <td>0.281532</td>
      <td>0.295043</td>
      <td>0.259002</td>
      <td>0.324320</td>
      <td>0.299552</td>
      <td>0.520275</td>
      <td>0.434682</td>
      <td>0.495491</td>
      <td>0.522514</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 26 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Definici&#243;n-del-conjunto-de-entrenamiento-y-de-prueba">Definici&#243;n del conjunto de entrenamiento y de prueba<a class="anchor-link" href="#Definici&#243;n-del-conjunto-de-entrenamiento-y-de-prueba">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Y</span> <span class="o">=</span> <span class="n">df_normalizado</span><span class="p">[[</span><span class="s1">&#39;cantidad&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_normalizado</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;cantidad&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(array([0.01714962]),
 array([0.0277942 , 0.72729201, 0.66666667, 0.8424335 , 0.66666667,
        0.7757838 , 0.63637521, 0.71515846, 0.75151669, 0.64244198,
        0.76971703, 0.72729201, 0.        , 0.11750881, 0.25900233,
        0.32432049, 0.29955225, 0.52027496, 0.43468184, 0.49549095,
        0.52251372, 0.3941477 , 0.38062055, 0.36936369, 0.08332282]))</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>25</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bunch_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
<span class="n">bunch_size</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>82</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x_train</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span><span class="o">-</span><span class="n">bunch_size</span><span class="p">]</span>
<span class="n">x_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="n">bunch_size</span><span class="p">:]</span>

<span class="n">y_train</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span><span class="o">-</span><span class="n">bunch_size</span><span class="p">]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="o">-</span><span class="n">bunch_size</span><span class="p">:]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(246, 82)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Definicion-y-Entrenamiento-del-Modelo">Definicion y Entrenamiento del Modelo<a class="anchor-link" href="#Definicion-y-Entrenamiento-del-Modelo">&#182;</a></h2><p>A modo de prueba se entrena y evalua un modelo centralizado</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">autograd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">autograd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># model = Sequential([Linear(25,4), Relu(), Linear(4,3), Relu(), Linear(3,1), Sigmoid()])</span>
<span class="c1"># model = Sequential([Linear(25,4), Sigmoid(), Linear(4,5), Sigmoid(), Linear(5,1), Sigmoid()])</span>
<span class="c1"># model = Sequential([Linear(25,4), Relu(), Linear(4,6), Relu(), Linear(6,1), Sigmoid()])</span>
<span class="c1"># model = Sequential([Linear(25,4), Sigmoid(), Linear(4,6), Sigmoid(), Linear(6,1), Sigmoid()])</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">([</span><span class="n">Linear</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">Tanh</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">Tanh</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">Sigmoid</span><span class="p">()])</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">MSELoss</span><span class="p">()</span>
<span class="c1"># optim = SGD(parameters=model.get_parameters(), alpha=0.01)</span>
<span class="n">optim</span> <span class="o">=</span> <span class="n">SGD</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>

<span class="c1"># 500</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">500</span><span class="p">):</span>
    <span class="c1"># Predecir</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
    <span class="c1"># Comparar</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
    
    <span class="c1"># Aprender</span>
    <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">loss</span><span class="o">.</span><span class="n">data</span><span class="p">)))</span>
    <span class="n">optim</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="k">100</span> == 0):
        <span class="nb">print</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[66.59855077]
[1.0714176]
[0.91269979]
[0.8268145]
[0.79791048]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_data</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
<span class="n">test_target</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>

<span class="n">pred_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pred</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
<span class="n">test_target_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">test_target</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">comparison</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;actual&#39;</span><span class="p">:</span><span class="n">test_target_list</span><span class="p">,</span> <span class="s1">&#39;predicted&#39;</span><span class="p">:</span><span class="n">pred_list</span><span class="p">})</span>
<span class="n">comparison</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>actual</th>
      <th>predicted</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.014193</td>
      <td>0.021984</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.010645</td>
      <td>0.017447</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.011827</td>
      <td>0.020254</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.062093</td>
      <td>0.017199</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.021881</td>
      <td>0.031740</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">denormalized_pred_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_values</span><span class="p">[</span><span class="s1">&#39;cantidad&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">min_values</span><span class="p">[</span><span class="s1">&#39;cantidad&#39;</span><span class="p">]))</span> <span class="o">+</span> <span class="n">min_values</span><span class="p">[</span><span class="s1">&#39;cantidad&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pred</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
<span class="n">denormalized_test_target_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_values</span><span class="p">[</span><span class="s1">&#39;cantidad&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">min_values</span><span class="p">[</span><span class="s1">&#39;cantidad&#39;</span><span class="p">]))</span> <span class="o">+</span> <span class="n">min_values</span><span class="p">[</span><span class="s1">&#39;cantidad&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">test_target</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
<span class="n">denormalized_comparison</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;actual&#39;</span><span class="p">:</span><span class="n">denormalized_test_target_list</span><span class="p">,</span> <span class="s1">&#39;predicted&#39;</span><span class="p">:</span><span class="n">denormalized_pred_list</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">denormalized_comparison</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>actual</th>
      <th>predicted</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>24.0</td>
      <td>37.174131</td>
    </tr>
    <tr>
      <td>1</td>
      <td>18.0</td>
      <td>29.503143</td>
    </tr>
    <tr>
      <td>2</td>
      <td>20.0</td>
      <td>34.249939</td>
    </tr>
    <tr>
      <td>3</td>
      <td>105.0</td>
      <td>29.084327</td>
    </tr>
    <tr>
      <td>4</td>
      <td>37.0</td>
      <td>53.671524</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE:&#39;</span><span class="p">,</span><span class="n">rmse</span><span class="p">(</span><span class="n">pred_list</span><span class="p">,</span> <span class="n">test_target_list</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>RMSE: 0.022350545248195304
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Modelo-de-Aprendizaje-Federado-con-Cifrado-Homomorfico">Modelo de Aprendizaje Federado con Cifrado Homomorfico<a class="anchor-link" href="#Modelo-de-Aprendizaje-Federado-con-Cifrado-Homomorfico">&#182;</a></h2><p>Como se dijo al inicio, vamos hacer las siguientes suposiciones sobre nuestro <code>dataset</code>:</p>
<ul>
<li>Se encuentra distribuido entre 3 instituciones</li>
<li>Contienen datos confidenciales que no pueden ser compartidos entre sí ni a un tercero</li>
</ul>
<p>Con estas condiciónes, el siguiente codigo pretende mostrar como podemos obtener un modelo capaz de predecir casos de dengue sin la necesidad de que el dueño del modelo o (<code>model owner</code>) tenga que acceder directamente a los datos de las instituciones (<code>data owners</code>)</p>
<h3 id="Definici&#243;n-de-la-arquitectura-y-del-metodo-de-entrenamiento-del-modelo">Definici&#243;n de la arquitectura y del metodo de entrenamiento del modelo<a class="anchor-link" href="#Definici&#243;n-de-la-arquitectura-y-del-metodo-de-entrenamiento-del-modelo">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">autograd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">autograd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">Linear</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">Relu</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">Relu</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">Sigmoid</span><span class="p">()]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">print_loss</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">criterion</span> <span class="o">=</span> <span class="n">MSELoss</span><span class="p">()</span>
    <span class="n">optim</span> <span class="o">=</span> <span class="n">SGD</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
        <span class="c1"># Predecir</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Comparar</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

        <span class="c1"># Aprender</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">loss</span><span class="o">.</span><span class="n">data</span><span class="p">)))</span>
        <span class="n">optim</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="k">100</span> == 0 and print_loss):
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\t</span><span class="s2">Loss:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">loss</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">model</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Definicion-de-funciones-auxiliares-para-manipular-modelos-encryptados">Definicion de funciones auxiliares para manipular modelos encryptados<a class="anchor-link" href="#Definicion-de-funciones-auxiliares-para-manipular-modelos-encryptados">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">encrypt_tensor</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">pubkey</span><span class="p">):</span>
    <span class="n">encrypt_weights</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">vector</span> <span class="ow">in</span> <span class="n">matrix</span><span class="p">:</span>
        <span class="c1"># print(vector)</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vector</span><span class="p">:</span>
            <span class="c1"># print(val)</span>
            <span class="n">encrypt_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pubkey</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
    <span class="n">restore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">encrypt_weights</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="c1"># print(restore)</span>
    <span class="k">return</span> <span class="n">restore</span>

<span class="k">def</span> <span class="nf">decrypt_tensor</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">privkey</span><span class="p">):</span>
    <span class="n">decrypted_weights</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">vector</span> <span class="ow">in</span> <span class="n">matrix</span><span class="p">:</span>
        <span class="c1"># print(vector)</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vector</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
            <span class="c1"># print(val)</span>
            <span class="n">decrypted_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">privkey</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
    <span class="n">restore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">decrypted_weights</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="c1"># print(restore)</span>
    <span class="k">return</span> <span class="n">restore</span>
    
<span class="k">def</span> <span class="nf">encrypt_sequential_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">pubkey</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span> <span class="o">==</span> <span class="n">Linear</span><span class="p">:</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">encrypt_tensor</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">pubkey</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>

<span class="k">def</span> <span class="nf">decrypt_sequential_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">n_models</span><span class="p">,</span> <span class="n">privkey</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span> <span class="o">==</span> <span class="n">Linear</span><span class="p">:</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">decrypt_tensor</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">privkey</span><span class="p">)</span><span class="o">/</span><span class="n">n_models</span>
    <span class="k">return</span> <span class="n">model</span>

<span class="k">def</span> <span class="nf">zero_sequential_model</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span> <span class="o">==</span> <span class="n">Linear</span><span class="p">:</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>

<span class="k">def</span> <span class="nf">aggregate_models</span><span class="p">(</span><span class="n">list_of_models</span><span class="p">):</span>
    <span class="n">aggregated_model</span> <span class="o">=</span> <span class="n">zero_sequential_model</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">list_of_models</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="c1"># print(list_of_models)</span>
    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">list_of_models</span><span class="p">:</span>
        <span class="c1"># print(model)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="n">Linear</span><span class="p">:</span>
                <span class="n">aggregated_model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span> <span class="o">+=</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span>
            
    <span class="k">return</span> <span class="n">aggregated_model</span>

<span class="k">def</span> <span class="nf">train_and_encrypt</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">pubkey</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">print_loss</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">new_model</span> <span class="o">=</span> <span class="n">train</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">model</span><span class="p">),</span> <span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">print_loss</span><span class="o">=</span><span class="n">print_loss</span><span class="p">)</span>
    <span class="n">encrypted_model</span> <span class="o">=</span> <span class="n">encrypt_sequential_model</span><span class="p">(</span><span class="n">new_model</span><span class="p">,</span> <span class="n">pubkey</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">encrypted_model</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Prueba-de-la-funcion-de-entrenamiento">Prueba de la funcion de entrenamiento<a class="anchor-link" href="#Prueba-de-la-funcion-de-entrenamiento">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">new</span> <span class="o">=</span> <span class="n">train</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>	Loss:[0.8324166]</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Pruebas-de-creaci&#243;n-de-un-modelo-encriptado">Pruebas de creaci&#243;n de un modelo encriptado<a class="anchor-link" href="#Pruebas-de-creaci&#243;n-de-un-modelo-encriptado">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">public_key</span><span class="p">,</span> <span class="n">private_key</span> <span class="o">=</span> <span class="n">phe</span><span class="o">.</span><span class="n">generate_paillier_keypair</span><span class="p">(</span><span class="n">n_length</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">autograd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">autograd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">Linear</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">Relu</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">Relu</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">Sigmoid</span><span class="p">()]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">train_and_encrypt</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">public_key</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">aggregate_models</span><span class="p">([</span><span class="n">model</span><span class="p">])</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">decrypt_sequential_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">private_key</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>	Loss:[0.8324166]</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>

<span class="n">pred_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pred</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
<span class="n">test_target_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">test_target</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE:&#39;</span><span class="p">,</span><span class="n">rmse</span><span class="p">(</span><span class="n">pred_list</span><span class="p">,</span> <span class="n">test_target_list</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>RMSE: 0.023673897541489297
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Distrubuci&#243;n-del-dataset-en-las-diferentes-Instituciones">Distrubuci&#243;n del dataset en las diferentes Instituciones<a class="anchor-link" href="#Distrubuci&#243;n-del-dataset-en-las-diferentes-Instituciones">&#182;</a></h2><p><code>Inicializamos</code> las entidades distribuyendo el dataset entre las tres y definimos un perceptron multicapa para realizar una regresión (predecir el numero de casos futuros)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">rangos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">rangos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">i</span><span class="p">))</span>
<span class="c1"># print(rangos)</span>

<span class="n">data_entidad_01</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">x_train</span><span class="p">[</span><span class="n">rangos</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">rangos</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">autograd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">target_entidad_01</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">y_train</span><span class="p">[</span><span class="n">rangos</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">rangos</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">autograd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">data_entidad_02</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">x_train</span><span class="p">[</span><span class="n">rangos</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">rangos</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">autograd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">target_entidad_02</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">y_train</span><span class="p">[</span><span class="n">rangos</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">rangos</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">autograd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">data_entidad_03</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">x_train</span><span class="p">[</span><span class="n">rangos</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">rangos</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> <span class="n">autograd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">target_entidad_03</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">y_train</span><span class="p">[</span><span class="n">rangos</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">rangos</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> <span class="n">autograd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">Linear</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">Relu</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">Relu</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">Sigmoid</span><span class="p">()]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># print(len(data_entidad_01.data))</span>
<span class="c1"># print(len(data_entidad_02.data))</span>
<span class="c1"># print(len(data_entidad_03.data))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include image.html class="center" alt="federated learning diagram" file="diagrams/federated-training.png" %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">Linear</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">Relu</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">Relu</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">Sigmoid</span><span class="p">()]</span>
<span class="c1"># layers = [Linear(25,4), Relu(), Linear(4,4), Relu(), Linear(4,1), Sigmoid()]</span>
<span class="c1"># layers = [Linear(25,4), Relu(), Linear(4,5), Relu(), Linear(5,1), Sigmoid()]</span>
<span class="c1"># layers = [Linear(25,4), Tanh(), Linear(4,3), Tanh(), Linear(3,1), Sigmoid()]</span>
<span class="c1"># layers = [Linear(25,4), Relu(), Linear(4,1), Sigmoid()]</span>
<span class="c1"># model = Sequential([Linear(25,4), Tanh(), Linear(4,6), Tanh(), Linear(6,1), Sigmoid()])</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Iniciando la ronda de entrenamiento Nro:&#39;</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Paso 1: enviamos el modelo a Institucion 01&#39;</span><span class="p">)</span>
    <span class="n">entidad_01_encrypted_model</span> <span class="o">=</span> <span class="n">train_and_encrypt</span><span class="p">(</span><span class="n">model</span><span class="p">,</span>
                                                   <span class="n">data_entidad_01</span><span class="p">,</span> 
                                                   <span class="n">target_entidad_01</span><span class="p">,</span> 
                                                   <span class="n">public_key</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.007</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">Paso 2: enviamos el modelo a Institucion 02&#39;</span><span class="p">)</span>
    <span class="n">entidad_02_encrypted_model</span> <span class="o">=</span> <span class="n">train_and_encrypt</span><span class="p">(</span><span class="n">model</span><span class="p">,</span>
                                                   <span class="n">data_entidad_02</span><span class="p">,</span> 
                                                   <span class="n">target_entidad_02</span><span class="p">,</span> 
                                                   <span class="n">public_key</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.007</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">Paso 3: enviamos el modelo a Institucion 03&#39;</span><span class="p">)</span>
    <span class="n">entidad_03_encrypted_model</span> <span class="o">=</span> <span class="n">train_and_encrypt</span><span class="p">(</span><span class="n">model</span><span class="p">,</span>
                                                   <span class="n">data_entidad_03</span><span class="p">,</span> 
                                                   <span class="n">target_entidad_03</span><span class="p">,</span> 
                                                   <span class="n">public_key</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.007</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">Paso 4: Institucion 01, Institucion 02 y Institucion 03 envian&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">y agregan sus modelos encriptados ente sí&#39;</span><span class="p">)</span>
    <span class="n">models_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">entidad_01_encrypted_model</span><span class="p">,</span> 
                   <span class="n">entidad_02_encrypted_model</span><span class="p">,</span> 
                   <span class="n">entidad_03_encrypted_model</span><span class="p">]</span>    
    <span class="n">encrypted_model</span> <span class="o">=</span> <span class="n">aggregate_models</span><span class="p">(</span><span class="n">models_list</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">Paso 5: Solo el modelo agregado&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">se envia devuelta al dueño del modelo&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">que puede desencriptarlo&#39;</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">decrypt_sequential_model</span><span class="p">(</span><span class="n">encrypted_model</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">models_list</span><span class="p">),</span> <span class="n">private_key</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
Iniciando la ronda de entrenamiento Nro: 1
	Paso 1: enviamos el modelo a Institucion 01
	Loss:[19.47686279]
	Paso 2: enviamos el modelo a Institucion 02
	Loss:[16.14403127]
	Paso 3: enviamos el modelo a Institucion 03
	Loss:[13.94539182]
	Paso 4: Institucion 01, Institucion 02 y Institucion 03 envian
	y agregan sus modelos encriptados ente sí

	Paso 5: Solo el modelo agregado
	se envia devuelta al dueño del modelo
	que puede desencriptarlo

Iniciando la ronda de entrenamiento Nro: 2
	Paso 1: enviamos el modelo a Institucion 01
	Loss:[0.10396935]
	Paso 2: enviamos el modelo a Institucion 02
	Loss:[1.33104586]
	Paso 3: enviamos el modelo a Institucion 03
	Loss:[5.38636908]
	Paso 4: Institucion 01, Institucion 02 y Institucion 03 envian
	y agregan sus modelos encriptados ente sí

	Paso 5: Solo el modelo agregado
	se envia devuelta al dueño del modelo
	que puede desencriptarlo

Iniciando la ronda de entrenamiento Nro: 3
	Paso 1: enviamos el modelo a Institucion 01
	Loss:[0.09768313]
	Paso 2: enviamos el modelo a Institucion 02
	Loss:[1.14368389]
	Paso 3: enviamos el modelo a Institucion 03
	Loss:[3.29253546]
	Paso 4: Institucion 01, Institucion 02 y Institucion 03 envian
	y agregan sus modelos encriptados ente sí

	Paso 5: Solo el modelo agregado
	se envia devuelta al dueño del modelo
	que puede desencriptarlo

Iniciando la ronda de entrenamiento Nro: 4
	Paso 1: enviamos el modelo a Institucion 01
	Loss:[0.1188239]
	Paso 2: enviamos el modelo a Institucion 02
	Loss:[0.81915177]
	Paso 3: enviamos el modelo a Institucion 03
	Loss:[2.09582635]
	Paso 4: Institucion 01, Institucion 02 y Institucion 03 envian
	y agregan sus modelos encriptados ente sí

	Paso 5: Solo el modelo agregado
	se envia devuelta al dueño del modelo
	que puede desencriptarlo

Iniciando la ronda de entrenamiento Nro: 5
	Paso 1: enviamos el modelo a Institucion 01
	Loss:[0.10003674]
	Paso 2: enviamos el modelo a Institucion 02
	Loss:[0.62974628]
	Paso 3: enviamos el modelo a Institucion 03
	Loss:[1.95877656]
	Paso 4: Institucion 01, Institucion 02 y Institucion 03 envian
	y agregan sus modelos encriptados ente sí

	Paso 5: Solo el modelo agregado
	se envia devuelta al dueño del modelo
	que puede desencriptarlo

Iniciando la ronda de entrenamiento Nro: 6
	Paso 1: enviamos el modelo a Institucion 01
	Loss:[0.08355167]
	Paso 2: enviamos el modelo a Institucion 02
	Loss:[0.5142198]
	Paso 3: enviamos el modelo a Institucion 03
	Loss:[1.91234242]
	Paso 4: Institucion 01, Institucion 02 y Institucion 03 envian
	y agregan sus modelos encriptados ente sí

	Paso 5: Solo el modelo agregado
	se envia devuelta al dueño del modelo
	que puede desencriptarlo

Iniciando la ronda de entrenamiento Nro: 7
	Paso 1: enviamos el modelo a Institucion 01
	Loss:[0.06705228]
	Paso 2: enviamos el modelo a Institucion 02
	Loss:[0.44322799]
	Paso 3: enviamos el modelo a Institucion 03
	Loss:[1.89337013]
	Paso 4: Institucion 01, Institucion 02 y Institucion 03 envian
	y agregan sus modelos encriptados ente sí

	Paso 5: Solo el modelo agregado
	se envia devuelta al dueño del modelo
	que puede desencriptarlo

Iniciando la ronda de entrenamiento Nro: 8
	Paso 1: enviamos el modelo a Institucion 01
	Loss:[0.05572313]
	Paso 2: enviamos el modelo a Institucion 02
	Loss:[0.40201215]
	Paso 3: enviamos el modelo a Institucion 03
	Loss:[1.87859799]
	Paso 4: Institucion 01, Institucion 02 y Institucion 03 envian
	y agregan sus modelos encriptados ente sí

	Paso 5: Solo el modelo agregado
	se envia devuelta al dueño del modelo
	que puede desencriptarlo

Iniciando la ronda de entrenamiento Nro: 9
	Paso 1: enviamos el modelo a Institucion 01
	Loss:[0.04391783]
	Paso 2: enviamos el modelo a Institucion 02
	Loss:[0.38376874]
	Paso 3: enviamos el modelo a Institucion 03
	Loss:[1.88579166]
	Paso 4: Institucion 01, Institucion 02 y Institucion 03 envian
	y agregan sus modelos encriptados ente sí

	Paso 5: Solo el modelo agregado
	se envia devuelta al dueño del modelo
	que puede desencriptarlo
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>

<span class="n">pred_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pred</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
<span class="n">test_target_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">test_target</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE:&#39;</span><span class="p">,</span><span class="n">rmse</span><span class="p">(</span><span class="n">pred_list</span><span class="p">,</span> <span class="n">test_target_list</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>RMSE: 0.026521617670045593
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">comparison</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;actual&#39;</span><span class="p">:</span><span class="n">test_target_list</span><span class="p">,</span> <span class="s1">&#39;predicted&#39;</span><span class="p">:</span><span class="n">pred_list</span><span class="p">})</span>
<span class="n">comparison</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>actual</th>
      <th>predicted</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.014193</td>
      <td>0.017758</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.010645</td>
      <td>0.013831</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.011827</td>
      <td>0.032553</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.062093</td>
      <td>0.032866</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.021881</td>
      <td>0.027633</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Como se puede ver en los resultados, el modelo obtenido es casi tan bueno que el modelo entrenado de forma centralizada.</p>
<h2 id="Notas-Finales">Notas Finales<a class="anchor-link" href="#Notas-Finales">&#182;</a></h2><p>Si bien los resultados no logran ser tan buenos como los resultados obtenidos en el paper, se logra demostrar que es posible entrenar un modelo con un <code>performance</code> relativamente bueno sin necesidad de acceder directamente a los datos. Con una mejora en la busqueda de los <code>hiperparametros</code> se podría mejorar aún más el performance del modelo.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Grid-Search">Grid Search<a class="anchor-link" href="#Grid-Search">&#182;</a></h3><p>Prueba para encontrar un mejor modelo usando Grid Search</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> 
          <span class="mf">0.003</span><span class="p">,</span> 
          <span class="mf">0.005</span><span class="p">,</span> 
          <span class="mf">0.007</span><span class="p">,</span> 
          <span class="mf">0.01</span><span class="p">,</span> 
          <span class="mf">0.01</span><span class="p">,</span> 
          <span class="mf">0.03</span><span class="p">,</span> 
          <span class="mf">0.05</span><span class="p">]</span>

<span class="n">architectures</span> <span class="o">=</span> <span class="p">[[</span><span class="n">Linear</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">Sigmoid</span><span class="p">()],</span>
                 <span class="p">[</span><span class="n">Linear</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">Sigmoid</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">Sigmoid</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">Sigmoid</span><span class="p">()],</span> 
                 <span class="p">[</span><span class="n">Linear</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">Tanh</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">Tanh</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">Sigmoid</span><span class="p">()],</span>
                 <span class="p">[</span><span class="n">Linear</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">Relu</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">Relu</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">Sigmoid</span><span class="p">()],</span>
                 
                 <span class="p">[</span><span class="n">Linear</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">Sigmoid</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">Sigmoid</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">Sigmoid</span><span class="p">()],</span>
                 <span class="p">[</span><span class="n">Linear</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">Tanh</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">Tanh</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">Sigmoid</span><span class="p">()],</span>
                 <span class="p">[</span><span class="n">Linear</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">Relu</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">Relu</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">Sigmoid</span><span class="p">()],</span> 
                 
                 <span class="p">[</span><span class="n">Linear</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">Sigmoid</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">Sigmoid</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">Sigmoid</span><span class="p">()],</span>
                 <span class="p">[</span><span class="n">Linear</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">Tanh</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">Tanh</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">Sigmoid</span><span class="p">()],</span>
                 <span class="p">[</span><span class="n">Linear</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">Relu</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">Relu</span><span class="p">(),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">Sigmoid</span><span class="p">()]]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">best_model</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">actual_rmse</span> <span class="o">=</span> <span class="mf">100.0</span>
<span class="k">for</span> <span class="n">architecture</span> <span class="ow">in</span> <span class="n">architectures</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>   
        <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">architecture</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">entidad_01_encrypted_model</span> <span class="o">=</span> <span class="n">train_and_encrypt</span><span class="p">(</span><span class="n">model</span><span class="p">,</span>
                                                           <span class="n">data_entidad_01</span><span class="p">,</span> 
                                                           <span class="n">target_entidad_01</span><span class="p">,</span> 
                                                           <span class="n">public_key</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>

            <span class="c1"># print(&#39;\n\tPaso 2: enviamos el modelo a Institucion 02&#39;)</span>
            <span class="n">entidad_02_encrypted_model</span> <span class="o">=</span> <span class="n">train_and_encrypt</span><span class="p">(</span><span class="n">model</span><span class="p">,</span>
                                                           <span class="n">data_entidad_02</span><span class="p">,</span> 
                                                           <span class="n">target_entidad_02</span><span class="p">,</span> 
                                                           <span class="n">public_key</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>

            <span class="c1"># print(&#39;\n\tPaso 3: enviamos el modelo a Institucion 03&#39;)</span>
            <span class="n">entidad_03_encrypted_model</span> <span class="o">=</span> <span class="n">train_and_encrypt</span><span class="p">(</span><span class="n">model</span><span class="p">,</span>
                                                           <span class="n">data_entidad_03</span><span class="p">,</span> 
                                                           <span class="n">target_entidad_03</span><span class="p">,</span> 
                                                           <span class="n">public_key</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>

            <span class="c1"># print(&#39;\n\tPaso 4: Institucion 01, Institucion 02 y Institucion 03 envian&#39;)</span>
            <span class="c1"># print(&#39;\ty agregan sus modelos encriptados ente sí&#39;)</span>
            <span class="n">models_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">entidad_01_encrypted_model</span><span class="p">,</span> 
                           <span class="n">entidad_02_encrypted_model</span><span class="p">,</span> 
                           <span class="n">entidad_03_encrypted_model</span><span class="p">]</span>    
            <span class="n">encrypted_model</span> <span class="o">=</span> <span class="n">aggregate_models</span><span class="p">(</span><span class="n">models_list</span><span class="p">)</span>

            <span class="c1"># print(&#39;\n\tPaso 5: Solo el modelo agregado&#39;)</span>
            <span class="c1"># print(&#39;\tse envia devuelta al dueño del modelo&#39;)</span>
            <span class="c1"># print(&#39;\tque puede desencriptarlo&#39;)</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">decrypt_sequential_model</span><span class="p">(</span><span class="n">encrypted_model</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">models_list</span><span class="p">),</span> <span class="n">private_key</span><span class="p">)</span>
        
        <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>

        <span class="n">pred_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pred</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
        <span class="c1"># test_target_list = [x[0] for x in test_target.data]</span>
        <span class="n">new_rmse</span> <span class="o">=</span> <span class="n">rmse</span><span class="p">(</span><span class="n">pred_list</span><span class="p">,</span> <span class="n">test_target_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">new_rmse</span> <span class="o">&lt;</span> <span class="n">actual_rmse</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Nuevo mejor RMSE:&#39;</span><span class="p">,</span><span class="n">new_rmse</span><span class="p">)</span>
            <span class="n">actual_rmse</span> <span class="o">=</span> <span class="n">new_rmse</span>
            <span class="n">best_model</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span>
            <span class="n">best_model</span><span class="p">[</span><span class="s1">&#39;architecture&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">architecture</span>
            <span class="n">best_model</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span>
            <span class="n">best_model</span><span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">actual_rmse</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>	Loss:[3.61176773]	Nuevo mejor RMSE: 0.05850939720417443
	Loss:[5.68172953]	Nuevo mejor RMSE: 0.033539178763380834
	Loss:[2.54063782]	Nuevo mejor RMSE: 0.027510551234677393
	Loss:[1.31393351]</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">best_model</span><span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">best_model</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">best_model</span><span class="p">[</span><span class="s1">&#39;architecture&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0.027510551234677393
0.001
[&lt;lightdlf.cpu.layers.Linear object at 0x122fee278&gt;, &lt;lightdlf.cpu.layers.Relu object at 0x122fee748&gt;, &lt;lightdlf.cpu.layers.Linear object at 0x122fee898&gt;, &lt;lightdlf.cpu.layers.Relu object at 0x122feeda0&gt;, &lt;lightdlf.cpu.layers.Linear object at 0x122feef60&gt;, &lt;lightdlf.cpu.layers.Sigmoid object at 0x12285acc0&gt;]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Apartado-de-pruebas-de-las-funciones-de-Cifrado-Homomorfico-(Homomorphic-Encryption)">Apartado de pruebas de las funciones de Cifrado Homomorfico (Homomorphic Encryption)<a class="anchor-link" href="#Apartado-de-pruebas-de-las-funciones-de-Cifrado-Homomorfico-(Homomorphic-Encryption)">&#182;</a></h3><p>Pruebas relizadas para las metodos de encriptado, agregación y desencriptado de un modelo</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">aux</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">([</span><span class="n">Linear</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)])</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">aux</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[-0.14882243,  0.12089122],
       [-0.66242815, -0.76576489],
       [ 0.51999856,  0.51318502]])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">encripted_tensor</span> <span class="o">=</span> <span class="n">encrypt_tensor</span><span class="p">(</span><span class="n">aux</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">pubkey</span><span class="o">=</span><span class="n">public_key</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">decrypt_tensor</span><span class="p">(</span><span class="n">encripted_tensor</span><span class="p">,</span> <span class="n">privkey</span><span class="o">=</span><span class="n">private_key</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[-0.14882243,  0.12089122],
       [-0.66242815, -0.76576489],
       [ 0.51999856,  0.51318502]])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">seq_aux</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">([</span><span class="n">Linear</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">Linear</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">seq_aux</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="n">encrypted_model</span> <span class="o">=</span> <span class="n">encrypt_sequential_model</span><span class="p">(</span><span class="n">seq_aux</span><span class="p">,</span> <span class="n">pubkey</span><span class="o">=</span><span class="n">public_key</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">encrypted_model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="n">decrypted_model</span> <span class="o">=</span> <span class="n">decrypt_sequential_model</span><span class="p">(</span><span class="n">encrypted_model</span><span class="p">,</span> <span class="n">n_models</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">privkey</span><span class="o">=</span><span class="n">private_key</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">decrypted_model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[[-0.45233024  1.52973627  0.71918349]
 [-0.76205292  0.76146533 -0.99324104]]

[[&lt;phe.paillier.EncryptedNumber object at 0x11a77cba8&gt;
  &lt;phe.paillier.EncryptedNumber object at 0x11a77c860&gt;
  &lt;phe.paillier.EncryptedNumber object at 0x121448be0&gt;]
 [&lt;phe.paillier.EncryptedNumber object at 0x1217e2898&gt;
  &lt;phe.paillier.EncryptedNumber object at 0x11a77c668&gt;
  &lt;phe.paillier.EncryptedNumber object at 0x1218e1c18&gt;]]

[[-0.45233024  1.52973627  0.71918349]
 [-0.76205292  0.76146533 -0.99324104]]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">zero_seq</span> <span class="o">=</span> <span class="n">zero_sequential_model</span><span class="p">(</span><span class="n">seq_aux</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">zero_seq</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[[0. 0.]
 [0. 0.]
 [0. 0.]]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">new_model</span> <span class="o">=</span> <span class="n">aggregate_models</span><span class="p">([</span><span class="n">aux</span><span class="p">,</span> <span class="n">aux</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">aux</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">new_model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[[-0.14882243  0.12089122]
 [-0.66242815 -0.76576489]
 [ 0.51999856  0.51318502]]
[[-0.29764486  0.24178245]
 [-1.3248563  -1.53152978]
 [ 1.03999713  1.02637003]]
</pre>
</div>
</div>

</div>
</div>

</div>
</div>
 

